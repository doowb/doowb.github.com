<!DOCTYPE html>
<html>
  <head>
    <title>doowb&#x27;s blog</title>
    <link rel="stylesheet" href="public/css/styles.css">
    <link rel="stylesheet" href="public/css/bootstrap.css">
  </head>
  <body>
        <div class="navbar navbar-fixed-top">
          <div class="navbar-inner">
            <div class="container">
              <ul class="nav">
                
            <li class="active"><a href="index.html">Home</a></li>
            
            <li><a href="info.html">About</a></li>
            
              </ul>
            </div>
          </div>
        </div>

    <div class="container">
      <div class="blog-header">
  <h1 class="blog-title">doowb&#x27;s blog</h1>
  <p class="lead blog-description">Notes, posts, todos, and other things that I think of.</p>
</div>

<div class="row">
  <div class="span8 blog-main">
    <div class="blog-post">
      <h2 class="blog-post-title"><a href="2018/12/26/12-days-of-node-day-01.html">12 Days of Node.js - Day 1: The beginning of a web application.</a></h2>
      <p class="blog-post-meta">December 26th, 2018 by <a href="https://github.com/doowb">doowb</a></p>

      <div>
  <img src="https://images.unsplash.com/photo-1516298761027-64d49da72287?ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;fm&#x3D;jpg&amp;crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;w&#x3D;1080&amp;fit&#x3D;max&amp;ixid&#x3D;eyJhcHBfaWQiOjQ4MjI0fQ">
  <span class="small em muted">
    Photo by <a href="https://unsplash.com/@thephotohiker?utm_source=blog&utm_medium=referral">Michael Hoyt</a> on <a href="https://unsplash.com/?utm_source=blog&utm_medium=referral">Unsplash</a>
  </span>
</div>

      <h2>Introduction</h2>
<p>This post is the beginning of a series of posts on building a web application in Node.js.
The goal is to finish with a working web application that has common user signup, authentication, and management. This includes allowing users to reset their passwords when they know their current password or if they've forgotten their password. It also includes managing users through an administration interface.</p>
<p>The series is split into 12 days starting on December 26th, 2018 and finishing on January 6th, 2019. Each post should only take 5 to 10 minutes to read and implement on your own.</p>
<h2>Setting up the server and web application</h2>
<p>To see the final code for this post, checkout the <a href="https://github.com/doowb/12-days-of-node/tree/day-01">Day 1</a> branch of the <a href="https://github.com/doowb/12-days-of-node">12 days of node repository</a>.</p>
<p>The structure for the project was created using the <a href="https://github.com/generate/generate">generate</a> <a href="https://github.com/generate/generate-project">project</a> generator. This generator creates common Node.js project files, configurations for linting and NPM, and GitHub repository files.</p>
<h3>The app</h3>
<p>We'll start with our <a href="https://github.com/doowb/12-days-of-node/blob/day-01/app.js">application JavaScript file</a> which contains the code for creating an instance of an <a href="http://expressjs.com">Express</a> app:</p>
<pre><code class="language-js">'use strict';

const express = require('express');

async function create() {
  let app = express();

  app.use((req, res) =&gt; {
    res.send('hello world');
  });

  return app;
};

module.exports = { create };
</code></pre>
<p>This file exports an object with a <code>create</code> method that is used to create the application. The application uses a single middleware that returns the string <code>&quot;hello world&quot;</code>. We'll get into middleware and how they're used in Express applications in future posts. For now, you just need to know that when someone goes to your web site in a browser, they'll see <code>hello world</code>.</p>
<h3>The server</h3>
<p>The next file to review is the <a href="https://github.com/doowb/12-days-of-node/blob/day-01/server.js">server JavaScript file</a> which contains the code that will start a server running that &quot;listens&quot; on port 3000. This means that on your local computer you'll be able to go to <a href="http://localhost:3000">http://localhost:3000</a> to access your web application (which will show &quot;hello world&quot;).</p>
<pre><code class="language-js">'use strict';

const http = require('http');
const { create } = require('./app');

const PORT = process.env.PORT || 3000;

const run = () =&gt; {
  return new Promise(async (resolve, reject) =&gt; {
    let app = await create();
    app.once('error', reject);

    let server = http.createServer(app);
    server.listen(PORT, () =&gt; {
      console.log('Web application listening on port:', PORT);
      console.log(`\thttp://localhost:${PORT}`);
    });

    process.on('SIGINT', resolve);
    process.on('SIGTERM', resolve);
  });
};

run()
  .then(() =&gt; {
    console.log('\nShutting down');
    process.exit(0);
  })
  .catch(err =&gt; {
    console.error(err);
    process.exit(1);
  });
</code></pre>
<p>Since this file is named <code>server.js</code>, you can run <code>npm start</code> from the command line to start the server. If you don't want to use NPM, you can also run <code>node server.js</code>. Once the server is started, go to <a href="http://localhost:3000">http://localhost:3000</a> to see your web app in action!</p>
<p>To stop the server, press <code>Ctrl+c</code> at the command line.</p>
<h2>Conclusion</h2>
<p>That's all for this post. In the next post, we'll talk routes, middleware, and how to use them to return something other than &quot;hello world&quot; to the browser.</p>

      <br><br>
      <hr>
      <br><br>
    </div>
    <div class="blog-post">
      <h2 class="blog-post-title"><a href="2017/01/09/octobox.js.html">Octobox.js</a></h2>
      <p class="blog-post-meta">January 9th, 2017 by <a href="https://github.com/doowb">doowb</a></p>

      
      <p><a href="https://octoboxjs.io"><img src="https://raw.githubusercontent.com/doowb/octobox.js/master/docs/demo.png" alt="octobox.js demo"></a></p>
<p>I published a new project last night called <a href="https://github.com/doowb/octobox.js">octobox.js</a> that's a <a href="https://nodejs.org/en/">node.js</a> project using <a href="http://expressjs.com/">express</a>, <a href="http://handlebarsjs.com/">handlebars</a>, and <a href="http://docs.sequelizejs.com/en/v3/">sequelize</a> instead of Ruby on Rails and ActiveDirectory.</p>
<p>The code can be found on GitHub at <a href="https://github.com/doowb/octobox.js">https://github.com/doowb/octobox.js</a> and the application is hosted on Heroku at <a href="https://octoboxjs.io">https://octoboxjs.io</a>.</p>
<p>I'll be documenting the process that I took to port the application and the libraries that I had to use and/or create to provide similar features to the original Ruby on Rails application.</p>

      <br><br>
      <hr>
      <br><br>
    </div>
    <div class="blog-post">
      <h2 class="blog-post-title"><a href="2017/01/09/heading-to-codemash.html">Heading to CodeMash</a></h2>
      <p class="blog-post-meta">January 9th, 2017 by <a href="https://github.com/doowb">doowb</a></p>

      
      <p>Leaving for <a href="http://codemash.org">CodeMash</a> today with <a href="https://github.com/jonschlinkert">Jon Schlinkert</a>. Hope to have updates over the next week with all of the interesting things I'll be learning and all the people I'll get to talk to.</p>
<p>If you're there and want to meetup, feel free to tweet me <a href="https://twitter/doowb">@doowb</a></p>

      <br><br>
      <hr>
      <br><br>
    </div>
    <div class="blog-post">
      <h2 class="blog-post-title"><a href="2014/01/30/angular-js-now-realtime-with-pusher.html">Realtime Angular.js with Pusher</a></h2>
      <p class="blog-post-meta">January 30th, 2014 by <a href="https://github.com/doowb">doowb</a></p>

      
      <p>There has been a lot of hype around using <a href="https://www.firebase.com/">Firebase</a> and <a href="http://angularjs.org/">Angular.js</a> to create realtime applications. These applications are great at keeping the application's state in sync between clients and providing a full realtime document database simliar to <a href="http://www.mongodb.org/">MongoDB</a> and <a href="http://couchdb.apache.org/">CouchDB</a>. What if you already have an Angular.js application, your data is already stored in MongoDB, and you just want to notify connected clients that something on the server has changed? This is where <a href="http://pusher.com/">Pusher</a> and <a href="https://github.com/doowb/angular-pusher">angular-pusher</a> come into play.</p>
<h3>Angular.js</h3>
<p>Angular.js is a client side JavaScript framework built by Google. It provides the framework for building either small components that can be plugged in to your website or entire single page applications. At the core of Angular.js is a module system that allows creating providers, services, factories, and directives. All of these are used within controllers to create, retrieve, update, and delete data while providing nice features for manipulating the HTML DOM with little custom JavaScript code.</p>
<p>In a simple Angular.js application, data is retrieved and sent to and from a backend server through an <code>$http</code> or <code>$resource</code> service provided by the framework. Below is an example of retrieving a list of items from an API and updating the selected item using the <code>$http</code> service.</p>
<pre><code class="language-js">var ItemListController = function ($scope, $http) {
  // initialize a list of items on the scope
  $scope.items = [];

  var retrieveItems = function () {
    // get a list of items from the api located at '/api/items'
    $http.get('/api/items')
        .success(function (items) {
          $scope.items = items;
        });
  };

  $scope.updateItem = function (item) {
    $http.post('/api/items', item);
  };

  // load the items
  retrieveItems();
};
</code></pre>
<pre><code class="language-html">&lt;div ng-controller='ItemListController'&gt;
    &lt;h1&gt;Items&lt;/h1&gt;
    &lt;table&gt;
      &lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Qty&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;
      &lt;tr ng-repeat=&quot;item in items&quot;&gt;
        &lt;td&gt;&lt;input type=&quot;text&quot; ng-model=&quot;item.name&quot;&gt;&lt;/td&gt;
        &lt;td&gt;&lt;input type=&quot;text&quot; ng-model=&quot;item.qty&quot;&gt;&lt;/td&gt;
        &lt;td&gt;&lt;button type=&quot;button&quot; ng-click=&quot;updateItem(item)&quot;&gt;Update&lt;/button&gt;&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
</code></pre>
<p>If we needed to know when items have been updated on the server by another user, we would have to constantly poll the server to find out if the <code>items</code> array changed.</p>
<pre><code class="language-javascript">var ItemListController = function ($scope, $http, $timeout) {

  $scope.items = [];

  var retrieveItems = function () {
    // get a list of items from the api located at '/api/items'
    $http.get('/api/items')
        .success(function (items) {
          $scope.items = items;

          // check for item changes
          $timeout(retrieveItems, 5000);
        });
  };

  ...
};
</code></pre>
<p>As you can see, we just update the <code>items</code> array every five seconds which isn't something that we want to keep doing. If a user is making a lot of changes, then we don't want to keep overwriting the <code>items</code> array. You could build the logic to only update changed items, but you still have the issue of polling the server every five seconds. It would be much nicer if we could subscribe to an event and wait for a notification of changes in realtime.</p>
<h3>Making Angular.js realtime with Pusher</h3>
<p>Using Pusher will allow us to subscribe to events triggered by other clients. First I'll show you the simple changes needed in our <code>ItemLIstController</code> to use angular-pusher. Then I'll show you an example of using Pusher in a Node.js server when an item is updated.</p>
<p>First, we need tell our Angular.js application to use angular-pusher. You can do this by either downloading the <a href="https://github.com/doowb/angular-pusher/blob/master/angular-pusher.js">development</a> or <a href="https://github.com/doowb/angular-pusher/blob/master/angular-pusher.min.js">production</a> files from <a href="https://github.com/doowb/angular-pusher/blob/master">GitHub</a> or using <code>bower install angular-pusher</code> and loading them into your page with the following script tag:</p>
<pre><code class="language-html">&lt;script type=&quot;text/javascript&quot; src=&quot;bower_components/angular-pusher/angular-pusher.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>This should be loaded after the <code>angular.min.js</code> file and before your <code>application.js</code> script.</p>
<p>Now we can tell our application that we want to use the services provided in <code>angular-pusher.min.js</code>.</p>
<pre><code class="language-javascript">angular.module('myApp', ['doowb.angular-pusher']).

config(['PusherServiceProvider',
    function(PusherServiceProvider) {
        PusherServiceProvider
            .setToken('d420162e600c57b0e60f')
            .setOptions({});
    }
]);
</code></pre>
<p>The angular-pusher module has a <code>PusherServiceProvider</code> that can be configured when creating your application. Here is where you can set your Pusher application key (<code>PusherServiceProvider.setToken('token')</code>), additional Pusher options (<code>PusherServiceProvider.setOptions(options)</code>), and a specific version of Pusher (<code>PusherServiceProvider.setPusherUrl(url)</code>). The Pusher url has a default, but it may be an older version.</p>
<p>Now we can use Pusher in our controller to subscribe to events and be notified when our <code>items</code> array changes:</p>
<pre><code class="language-javascript">var ItemListController = function($scope, $http, Pusher) {
    $scope.items = [];

    Pusher.subscribe('items', 'updated', function (item) {
    // an item was updated. find it in our list and update it.
        for (var i = 0; i &lt; $scope.items.length; i++) {
            if ($scope.items[i].id === item.id) {
                $scope.items[i] = item;
                break;
            }
        }
    });

  var retrieveItems = function () {
    // get a list of items from the api located at '/api/items'
    console.log('getting items');
    $http.get('/api/items')
        .success(function (items) {
          $scope.items = items;
      });
  };

  $scope.updateItem = function (item) {
    console.log('updating item');
    $http.post('/api/items', item);
  };

  // load the items
  retrieveItems();
}
</code></pre>
<p>In the Node.js server, we setup our connection to Pusher with a few lines of code. It only takes one more line of code to trigger the actual update notification:</p>
<pre><code class="language-javascript">// setup Pusher
var Pusher = require('pusher');
var pusher = new Pusher({
  appId: '12345',
  key: 'some key',
  secret: 'my secret... shhh!!!'
});

// in our express server
// setup a post route and trigger the change in Pusher
app.post('/api/items', function (req, res) {

  // get our item from the req and update the item collection
  // in a production application this would have validation and items
  // would be stored in a database.
  var item = req.body;
  items[item.id] = item;

  // tell Pusher to trigger an 'updated' event on the 'items' channel
  // add pass the changed item to the event
  pusher.trigger('items', 'updated', item);

  // respond with the changed item
  res.json(item);
});

</code></pre>
<h3>Get Pushing</h3>
<p>All of this code can be found <a href="https://github.com/doowb/angular-pusher">here on GitHub</a>. The <a href="https://github.com/doowb/angular-pusher/tree/gh-pages"><code>gh-pages</code> branch</a> contains the examples that these code snippets came from. The application itself can be <a href="http://doowb.github.io/angular-pusher">found here</a>, but the server side examples won't work when hosted on <a href="http://pages.github.com/">GitHub Pages</a>.</p>
<p>Hopefully this article and the code samples are enough to get your Angular.js application working with Pusher.</p>

      <br><br>
      <hr>
      <br><br>
    </div>
  </div>

  <div class="span3 offset1 blog-sidebar">
    <div class="sidebar-module sidebar-module-inset">
      <h4>About</h4>
      <p>Learn more about me on <a href="https://github.com/doowb" target="_blank">GitHub</a> and follow me on twitter <a href="https://twitter/doowb" target="_blank">@doowb</a></p>
    </div>
  </div><!-- /.blog-sidebar -->
</div>

    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-67453407-3', 'auto');
      ga('send', 'pageview');
    
    </script>
    <script src="public/js/jquery.js"></script>
  </body>
</html>

